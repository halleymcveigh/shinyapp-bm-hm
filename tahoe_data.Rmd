---
title: "Tahoe Data"
author: "Halley McVeigh"
date: "2/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(tidyverse)
library(janitor)
library(tmap)
library(sf)
library(maps)
library(mapdata)
library(ggmap)
```

Read in data

```{r}
benefits <- read_csv(here("data", "benefits_polygons.csv"))

impacts <- read_csv(here("data", "adverse_impacts_polygons.csv"))

mgmt <- read_csv(here("data", "mgmt_prioritization_polygons.csv"))
```



tmap_mode("view")


```{r}
tmap_mode("view")

# Read in data for spatial analysis
benefits_sf <- read_sf(here("data", "benefits_polygons.shp")) %>% 
  clean_names() %>% 
  select(c(14:33,40:41))

benefits_tidy_sf <- benefits_sf %>% 
  pivot_longer(c(1:19), names_to = "ecosystem_benefit", values_to = "count") %>% 
  drop_na() %>% 
  select(respondent = responde_1, association = responde_8, ecosystem_benefit, count, geometry)


```

### Examine and set CRS
```{r}
benefits_sf %>% st_crs()

```

```{r}
tahoe_gg <- ggplot(data = benefits_tidy_sf) +
  geom_sf(aes(geometry = geometry, fill = ecosystem_benefit), color = "darkcyan") +
  theme_minimal()

tahoe_gg

benefits_tidy_sf = st_as_sf(benefits_tidy_sf)

class(benefits_tidy_sf)

tm_basemap("Stamen.Watercolor")
tmap_options(check.and.fix = TRUE)

tm_shape(benefits_tidy_sf) +
  tm_polygons()

```

```{r}
tahoe_map <- get_stamenmap(bbox = c(left = -122,
                                    bottom = 36,
                                    right = -118,
                                    top = 41),
                           maptype = "watercolor",
                           crop = FALSE)
ggmap(tahoe_map) +
  theme_void()
  


tahoe <- tahoe_gg + ggmap(tahoe_map)
  geom_sf(data = benefits_tidy_sf,aes(geometry = geometry, fill = ecosystem_benefit), color = "darkcyan") +
  theme_minimal()
```







